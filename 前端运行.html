<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>

  <!-- 建议使用明确的协议（https:），避免使用协议相对URL（//） -->
  <!-- 引入ElementPlus样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
  <!-- 引入Vue 3 -->
  <script src="https://unpkg.com/vue@3"></script>
  <!-- 引入ElementPlus组件库 -->
  <script src="https://unpkg.com/element-plus"></script>
  <!-- 引入ElementPlus icon组件库 -->
  <script src="https://unpkg.com/@element-plus/icons-vue"></script>
  <!-- 引入SheetJS (xlsx)库 -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <link rel="stylesheet" href="./css/index.css" />
</head>

<body>
  <div id="app">
    <div class="header-container">
      <div class="upload-product-excel">
        <el-upload drag action="#" accept=".xlsx, .xls, .csv" class="component-upload" :file-list="productFileList"
          :limit="1" :auto-upload="false" :on-change="handleFileChange">
          <el-icon size="30" style="color:#909399;">
            <Plus />
          </el-icon>
          <!-- <div class="el-upload__text">将Coupang产品Excel文件拖到此处，或<em>点击上传</em></div> -->
          <div class="el-upload__text">将Excel文件拖到框内，或
            <div>
              <em>点击上传</em>
            </div>
          </div>

          <template #file="{ file }">
            <div class="component-upload-slot-filelist">
              <div class="file-container">
                <svg width="28" height="28" t="1765910580191" class="icon" viewBox="0 0 1024 1024" version="1.1"
                  xmlns="http://www.w3.org/2000/svg" p-id="8570" width="200" height="200">
                  <path
                    d="M951.296 682.496c12.8 0 21.504-9.216 21.504-22.528V287.232L801.28 102.4H323.584c-47.104 0-85.504 40.448-85.504 90.112v74.24H94.208c-23.552 0-43.008 20.48-43.008 45.056v446.976c0 25.088 19.456 45.056 43.008 45.056h143.36v58.368c0 49.664 38.4 90.112 85.504 90.112h563.712c47.104 0 85.504-40.448 85.504-90.112v-67.584c0-13.312-8.704-22.528-21.504-22.528s-21.504 9.216-21.504 22.528v67.584c0 25.088-19.456 45.056-43.008 45.056H323.584c-23.552 0-43.008-20.48-43.008-45.056v-58.88h235.52c23.552 0 43.008-20.48 43.008-45.056V312.32c0-24.576-19.456-45.056-43.008-45.056h-235.52V192.512c0-25.088 19.456-45.056 43.008-45.056h435.2v117.248c0 36.352 27.648 67.584 64.512 67.584h107.008v327.168c-0.512 13.824 8.192 23.04 20.992 23.04zM304.128 499.712l47.104-72.192h64.512l-75.264 112.64 90.112 131.072h-66.56l-57.856-85.504-57.856 85.504h-66.56l90.112-131.072-77.312-112.64h66.56l43.008 72.192z m518.656-212.48c-12.8 0-21.504-9.216-21.504-22.528V165.376l111.616 121.856h-90.112z"
                    fill="#45B058" p-id="8571"></path>
                  <path
                    d="M739.84 693.248h-101.376c-12.288 0-20.48 9.216-20.48 23.552s8.192 23.552 20.48 23.552h101.376c12.288 0 19.968-9.216 19.968-23.552 0.512-14.336-7.68-23.552-19.968-23.552z m0-118.272h-101.376c-12.288 0-20.48 9.216-20.48 23.552s8.192 23.552 20.48 23.552h101.376c12.288 0 19.968-9.216 19.968-23.552s-7.68-23.552-19.968-23.552z m0-118.272h-101.376c-12.288 0-20.48 9.216-20.48 23.552s8.192 23.552 20.48 23.552h101.376c12.288 0 19.968-9.216 19.968-23.552 0.512-13.824-7.68-23.552-19.968-23.552z"
                    fill="#45B058" p-id="8572"></path>
                </svg>

                <el-text truncated style="margin-left: 6px;">
                  {{ `${file.name}(${formatSize(file.size)})` }}
                </el-text>
              </div>

              <!-- 删除按钮 -->
              <el-icon @click="handleRemove(file)" class="file-remove-btn">
                <Close />
              </el-icon>
            </div>
          </template>
        </el-upload>
      </div>

      <div class="merge-description">
        <template v-if="!mergeInfoList.length">
          <el-text size="large" type="success" style="display: flex; align-items: center;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" style="width: 20px; margin-right: 4px;">
              <path fill="currentColor"
                d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.27 38.27 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z">
              </path>
            </svg>
            未检测到被合并曝光商品信息
          </el-text>
        </template>
        <template v-else>
          <el-descriptions title="被合并曝光商品信息" border>
            <template v-for="(obj, index) in mergeInfoList">
              <el-descriptions-item label-width="120" width="120" :label="`${index + 1}. 商品曝光ID`""
                  >{{ obj.PID }}</el-descriptions-item
                >
                <el-descriptions-item label-width=" 120" width="80" label="合并商品个数">{{ obj.productList.length
                }}</el-descriptions-item>
              <el-descriptions-item label-width="120" label="合并产品">
                {{ obj.productList.map(item => item.PN).join(", ") }}
              </el-descriptions-item>
            </template>
          </el-descriptions>
        </template>
      </div>
    </div>

    <div class="product-table">
      <div class="search-box">
        <div class="search-box-items">
          <!-- 商品曝光id搜索框 -->
          <div class="search-box-item">
            <el-input v-model="searchForm.PID" style="width: 320px" placeholder="输入商品曝光ID" clearable>
              <template #prepend>
                商品曝光ID
              </template>

              <template #append>
                <el-checkbox v-model="searchForm.PID_first" label="优先" size=""></el-checkbox>
              </template>
            </el-input>
          </div>

          <!-- 注册商品id搜索框 -->
          <div class="search-box-item">
            <el-input v-model="searchForm.RID" style="width: 320px" placeholder="输入注册商品ID" clearable>
              <template #prepend>
                注册商品ID
              </template>

              <template #append>
                <el-checkbox v-model="searchForm.RID_exclude" label="取反" size=""></el-checkbox>
              </template>
            </el-input>
          </div>

          <!-- 与、或 下拉选项框 -->
          <div class="search-box-item">
            <el-select v-model="searchForm.union" placeholder="选择查询方法" style="width: 80px">
              <el-option :key="0" label="或" :value="0"></el-option>
              <el-option :key="1" label="与" :value="1"></el-option>
            </el-select>
          </div>

          <div class="search-btns">
            <el-button type="primary" @click="handleSearch">
              <svg style="width: 14px; margin-right: 4px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                <path fill="currentColor"
                  d="m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704">
                </path>
              </svg>搜索
            </el-button>
            <el-button type="danger" @click="handleReset">
              <svg style="width: 14px; margin-right: 4px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                <path fill="currentColor"
                  d="M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z">
                </path>
              </svg>
              重置
            </el-button>
          </div>
        </div>

        <div class="table-header-btns">
          <el-button type="primary" plain @click="downloadTemplate">
            <el-icon style="margin-right: 4px;">
              <Download />
            </el-icon>
            下载模板
          </el-button>
          <el-button type="primary" plain @click="dialogVisible = true">
            <el-icon style="margin-right: 4px;">
              <Upload />
            </el-icon>
            上传HTML代码
          </el-button>
        </div>
      </div>
      <el-table border style="width: 100%" align="" empty-text="空数据" v-loading="tableLoading"
        height="calc(100vh - 232px)" :header-cell-style="{
          backgroundColor: '#F6F9FC',
          color: '#82909F'
        }" :data="formatProductList" :span-method="PIDSpanMethod">
        <el-table-column label="商品曝光ID">
          <template #default="scope">
            <div style="display: flex; align-items: center; justify-content: center;">
              <el-link type="primary" @click="openCoupangLink(scope.row)">{{ scope.row.PID }}</el-link>
              <div class="custom-text-btn" @click="handleCopy(scope.row.PID, { mode: 'single' })">
                <svg style="width: 12px; height:16px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                  <path fill="currentColor"
                    d="M128 320v576h576V320zm-32-64h640a32 32 0 0 1 32 32v640a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V288a32 32 0 0 1 32-32M960 96v704a32 32 0 0 1-32 32h-96v-64h64V128H384v64h-64V96a32 32 0 0 1 32-32h576a32 32 0 0 1 32 32M256 672h320v64H256zm0-192h320v64H256z">
                  </path>
                </svg>
              </div>
            </div>
          </template>
        </el-table-column>
        <el-table-column label="注册商品ID" prop="groupIndexShow" width="160"></el-table-column>
        <el-table-column label="产品管理名称" prop="PN"></el-table-column>
        <el-table-column label="产品图片" align="center" prop="skuImgurl" width="90">
          <template #default="scope">
            <div style="width: 100%; display: flex; align-items: center; justify-content: center;">
              <el-image ref="imageRef" style="width: 36px; height: 36px; " :src="scope?.row?.skuImgurl || ''"
                fit="cover" @click="handleImagePreview(scope?.row?.skuImgurl || '')">
                <template #error>
                  <svg t="1766151076232" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="4428" width="32" height="32">
                    <path
                      d="M854.5 82h-685c-58.2 0-105.4 49.2-105.4 109.8v640.4c0 60.6 47.2 109.8 105.4 109.8H854.6c58.2 0 105.4-49.2 105.4-109.8V191.8C959.9 131.2 912.7 82 854.5 82zM223.6 223.3l11.3-11.7c8.1-8.4 54.7 22.5 101.4 64.9 46.9-42.8 93.4-73.4 101.5-64.9l11.3 11.7c9.6 10-20.2 57.3-61.3 105.3 41.9 47.3 71.3 94.3 60.6 105.5l-11.3 11.7c-10.6 11-55.3-19.8-100.8-63.1-45.4 43-90.3 74-100.8 63.1L224.3 434c-10.5-11 19.3-58.3 60.7-105.5-40.9-47.8-70.9-95.3-61.4-105.2z m630.9 590.6c-12.9 41.9 0.6 36.6-333.7 36.6-338.1 0-342.2-0.8-351.3-47.8-14.2-73.5 64.8-246.2 122.9-208.3 24.9 16.2 81.4 72.5 105.4 73.2 126.9 3.9 212.1-237.9 298.6-237.9 82.3 0 190.8 278.1 158.1 384.2z"
                      p-id="4429" fill="#cdcdcd"></path>
                  </svg>
                </template>
              </el-image>
            </div>
          </template>
        </el-table-column>
        <el-table-column label="SKU名称" prop="SKUNAME"></el-table-column>
        <!-- <el-table-column label="SKUID(本土店才有)" prop="SKUID"></el-table-column> -->
        <el-table-column prop="VID">
          <template #header="scope">
            <div style="display: flex;align-items:center;">
              <span>选项ID</span>
              <el-dropdown size="default" style="margin-left: 12px; line-height: 23px;"  @command="handleCopyMenuCommand">
                <span class="el-dropdown-link" style="cursor: pointer; color: #409eff;">
                  选择复制方式<el-icon class="el-icon--right"><arrow-down /></el-icon>
                </span>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item command="linebreak">保持换行</el-dropdown-item>
                    <el-dropdown-item command="comma">逗号隔开</el-dropdown-item>
                    <el-dropdown-item command="space">空格隔开</el-dropdown-item>
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </div>
          </template>
        </el-table-column>
      </el-table>
    </div>

    <el-dialog v-model="dialogVisible" title="HTML结构解析JSON" width="1200" :before-close="handleDialogClose">
      <div class="dialog-html-content">
        <el-input v-model="htmlContent" :autosize="{ minRows: 20, maxRows: 20 }" type="textarea"
          placeholder="请确保产品信息全部展开完整后，粘贴HTML代码" />
      </div>
      <template #footer>
        <div class="dialog-footer">
          <el-button @click="dialogVisible = false">取消</el-button>
          <el-button type="primary" :loading="parseLoading" @click="parseHTMLContent">
            开始解析
          </el-button>
        </div>
      </template>
    </el-dialog>

    <el-image-viewer v-if="showImagePreview" :url-list="[imagePreviewUrl]" show-progress
      @close="showImagePreview = false" />
  </div>

  <!-- vue应用代码文件 -->
  <script src="./js/main.js"></script>
</body>

</html>